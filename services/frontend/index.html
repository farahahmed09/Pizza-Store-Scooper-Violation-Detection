<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Pizza Store Scooper Violation Detection</title>
    <style>
        body { font-family: sans-serif; display: flex; flex-direction: column; align-items: center; background-color: #1a1a1a; color: #e0e0e0; margin: 0; padding: 20px; box-sizing: border-box; }
        .header h1 { color: #0099ff; }
        .container { display: flex; flex-wrap: wrap; gap: 24px; justify-content: center; width: 100%; max-width: 1600px; }
        .video-container { flex: 3; min-width: 600px; max-width: 1024px; }
        #video { border: 2px solid #333; border-radius: 8px; width: 100%; }
        .panel { flex: 1; min-width: 320px; background-color: #242424; border-radius: 8px; padding: 24px; border: 1px solid #333; }
        .panel-title { margin-top: 0; color: #0099ff; border-bottom: 2px solid #0099ff; padding-bottom: 10px; text-align: center; }
        .info-box { text-align: center; margin-bottom: 24px; }
        #violation-count { font-size: 4.5em; font-weight: bold; color: #28a745; margin: 0; }
        #view-violations-btn { background-color: #007bff; color: white; border: none; padding: 12px 20px; border-radius: 5px; font-size: 1em; cursor: pointer; margin-top: 20px; width: 100%; }
        #violations-container { margin-top: 20px; width: 100%; text-align: left; max-height: 400px; overflow-y: auto; }
        .violation-item { background-color: #333; border-radius: 5px; padding: 10px; margin-bottom: 10px; }
        .violation-item p { margin: 0 0 5px 0; }
        .violation-item img { width: 100%; border-radius: 4px; margin-top: 10px; }
    </style>
</head>
<body>
    <div class="header"><h1>Pizza Store Scooper Violation Detection</h1></div>
    <div class="container">
        <div class="video-container"><img id="video" alt="Live feed loading..."></div>
        <div class="panel">
            <h2 class="panel-title">Analysis</h2>
            <div class="info-box"><h3>Violations</h3><p id="violation-count">0</p></div>
            <button id="view-violations-btn">View Saved Violations</button>
            <div id="violations-container"></div>
        </div>
    </div>

    <script>
        const videoElement = document.getElementById('video');
        const violationCountElement = document.getElementById('violation-count');
        const viewViolationsBtn = document.getElementById('view-violations-btn');
        const violationsContainer = document.getElementById('violations-container');
        
        // WebSocket logic (unchanged)
        function connectWebSocket() {
            const ws = new WebSocket("ws://localhost:8000/ws/video");
            ws.onmessage = (event) => {
                const data = JSON.parse(event.data);
                videoElement.src = "data:image/jpeg;base64," + data.frame;
                violationCountElement.textContent = data.violations;
            };
            ws.onclose = () => setTimeout(connectWebSocket, 2000);
        }

        // Fetch and display violations
        viewViolationsBtn.addEventListener('click', async () => {
            violationsContainer.innerHTML = "<p>Loading violations...</p>";
            const response = await fetch('/api/violations');
            const violations = await response.json();
            
            let content = '<h3>Saved Violations</h3>';
            if (violations.length === 0) {
                content += '<p>No violations saved yet.</p>';
            } else {
                violations.forEach(v => {
                    // Extract just the filename from the path
                    const imageName = v.image_path.split(/[\\/]/).pop();
                    content += `
                        <div class="violation-item">
                            <p><b>ID:</b> ${v.id}</p>
                            <p><b>Timestamp:</b> ${new Date(v.timestamp).toLocaleString()}</p>
                            <p><b>Frame:</b> ${v.frame_index}</p>
                            <img src="/violations/image/${imageName}" alt="Violation Frame ${v.id}">
                        </div>
                    `;
                });
            }
            violationsContainer.innerHTML = content;
        });

        connectWebSocket();
    </script>
</body>
</html>